# 测试环境配置
# 使用 Testcontainers 的 @ServiceConnection 自动配置数据库连接

spring:
  # Jackson 配置
  jackson:
    serialization:
      write-dates-as-timestamps: false
      write-date-timestamps-as-nanoseconds: false
    deserialization:
      read-date-timestamps-as-nanoseconds: false
  # Redis 配置
  # 注意: host 和 port 会被 BaseIntegrationTest 中的 @DynamicPropertySource 动态覆盖为 Testcontainer 的实际地址
  data:
    redis:
      host: localhost
      port: 6379
      database: 0

  jpa:
    hibernate:
      # 测试环境使用 create-drop，每个测试类开始时重新创建表
      ddl-auto: create-drop
    # 测试时显示 SQL 便于调试
    show-sql: false
    properties:
      hibernate:
        format_sql: true
        # 测试时使用批处理提高性能
        jdbc:
          batch_size: 20
        order_inserts: true
        order_updates: true
  # 测试时禁用 SQL 初始化脚本
  sql:
    init:
      mode: never

# Sa-Token 测试配置
sa-token:
  # 测试环境使用简单的密钥
  jwt-secret-key: test-secret-key-for-testing-only
  timeout: 86400   # 1 天
  is-print: false
  is-log: false

# Redisson 测试配置
yimusi:
  lock:
    redisson:
      enabled: true
      wait-time: PT3S  # 测试环境短一点的等待时间
      lock-watchdog-timeout: PT15S # 测试环境短一点的看门狗续约周期

# 日志配置 - 测试时减少日志输出
logging:
  level:
    root: WARN
    com.yimusi: INFO
    org.springframework: WARN
    org.hibernate: WARN
    org.testcontainers: INFO
